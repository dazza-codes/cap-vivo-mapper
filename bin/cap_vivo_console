#!/usr/bin/env ruby
require 'rubygems'
require 'bundler/setup'

require 'cap'
require 'cap/client'
require 'cap/vivo'

include Cap::Vivo::GraphUtils
include Cap::Vivo::Orgs

# init configs
Cap.configuration

# client will load profile data from a local repo; if it is empty, it
# can be populated from the CAP API using `client.get_profiles`.  The
# profile data is available in `client.profiles`.
client = Cap::Client::Client.new
ids = client.profile_ids
puts "Currently holding #{ids.length} CAP profiles in local repo"

# Stanford CAP to VIVO sample data
require_relative 'cap_sample_profiles'
test_profile_docs = test_profiles.map do |id|
  p = client.profile_doc(id)
  p['publications'] = client.publication_doc(id)['publications']
  p
end

require 'pry'; binding.pry;
